---
phase: 02-cms-integration
task: CORS checkpoint
total_tasks: 5 plans (02-01 through 02-05)
status: in_progress
last_updated: 2026-02-04
---

<current_state>
Phase 2: CMS Integration is mostly implemented. All Sanity schemas, Studio route, client config, and GROQ queries are created and deployed to Vercel. We are paused at a CORS configuration checkpoint — the user needs to configure CORS origins in the Sanity dashboard before the Studio will work on localhost and production.

The Vercel deployment is live at https://koorfameus.vercel.app with the Studio route at /studio.
</current_state>

<completed_work>

## Phase 1: Project Foundation — COMPLETE
- 4 plans executed, verified, all committed
- Next.js 16 + Tailwind v4 + shadcn/ui + Geist Sans
- Responsive placeholder page with Header, Hero, Footer
- Official KoorFameus logo (flat + 3D variant) integrated
- Deployed to Vercel: https://koorfameus.vercel.app
- GitHub: https://github.com/GolicoBV/KoorFameus
- ROADMAP.md and STATE.md updated, requirements TECH-01 and TECH-05 marked complete

## Phase 2: CMS Integration — IN PROGRESS
- Plan 02-01: Sanity packages installed (next-sanity, sanity, @sanity/image-url) ✓
- Sanity project created: ID `rzrgvvg3`, dataset `production` ✓
- .env.local created with NEXT_PUBLIC_SANITY_PROJECT_ID and NEXT_PUBLIC_SANITY_DATASET ✓
- Plan 02-02: All schemas created ✓
  - siteSettings (singleton with Structure Builder)
  - page (title, slug, hero, content, SEO)
  - teamMember (name, role, function, koren ref, photo, bio, order)
  - koor (name, slug, ageRange, description, schedule, image)
  - event (title, date, location, description, koren ref, isPublic)
  - blockContent (rich text with images, links, headings)
- Plan 02-03: Studio embedded at /app/studio/[[...tool]]/ ✓
  - page.tsx with NextStudio component
  - Separate layout.tsx to isolate Studio styling
- Plan 02-04: Sanity client and helpers ✓
  - sanity/lib/client.ts (CDN in production)
  - sanity/lib/queries.ts (all GROQ queries for all content types)
  - sanity/lib/image.ts (URL builder with presets)
  - next.config.ts updated for cdn.sanity.io remote images
- sanity.config.ts with Structure Builder for siteSettings singleton ✓
- Build verified, deployed to Vercel ✓
- Committed and pushed to GitHub ✓

## NOT YET DONE
- Plan 02-05: Revalidation webhook (api/revalidate route) — not started
- CORS configuration at sanity.io/manage — WAITING ON USER
- Vercel env vars (NEXT_PUBLIC_SANITY_PROJECT_ID, NEXT_PUBLIC_SANITY_DATASET) may need to be set in Vercel dashboard
- Phase 2 SUMMARY.md files not yet created
- Phase 2 verification not yet run
- STATE.md and ROADMAP.md not yet updated for Phase 2 completion
</completed_work>

<remaining_work>

## Phase 2 Remaining
1. User configures CORS at https://www.sanity.io/manage/personal/project/rzrgvvg3/api
   - Add http://localhost:3000 (allow credentials)
   - Add https://koorfameus.vercel.app (allow credentials)
2. Create revalidation webhook route (Plan 02-05):
   - /app/api/revalidate/route.ts with signature validation
   - Tag-based revalidation
   - User configures webhook in Sanity dashboard
   - SANITY_REVALIDATE_SECRET env var in Vercel
3. Create SUMMARY.md files for each plan
4. Run phase verifier
5. Update STATE.md, ROADMAP.md
6. Commit phase completion

## Remaining Phases (3-10)
- Phase 3: Design System (header, footer, navigation with CMS data)
- Phase 4: Homepage (hero + choir overview from CMS)
- Phase 5: Choir Pages (/koren/[slug])
- Phase 6: Team Pages (/wie-zijn-wij)
- Phase 7: Events (/evenementen)
- Phase 8: Media Gallery (/galerij)
- Phase 9: Forms & Email (contact + registration + Resend)
- Phase 10: Polish & Compliance (SEO, cookies, privacy, performance)
</remaining_work>

<decisions_made>

- **Font:** Geist Sans — native Next.js integration, modern, fits playful vibe
- **Colors:** Coral #F3504C primary, #D34153 hover, #1F1F1F text, #FFFFFF/#F4F4F4 backgrounds
- **Logo:** Using flat logo (logo.png) for header/footer, 3D variant (logo-3d.png) available
- **Sanity schemas:** Created ALL schemas upfront (not just Phase 2 requirements) including koor, event — saves rework later
- **Structure Builder:** siteSettings as singleton, all other types as lists
- **GROQ queries:** Pre-written for all content types in sanity/lib/queries.ts
- **Image presets:** hero (1920x600), card (600x400), avatar (200x200), thumbnail (300x200), og (1200x630)
- **Package name:** koor-fameus (lowercase, npm restriction)
- **Dutch labels:** All Sanity schema labels in Dutch for administrators
- **Model profile:** quality (Opus for executors)
- **Workflow mode:** YOLO (auto-approve)
</decisions_made>

<blockers>
- CORS: User needs to configure CORS origins in Sanity dashboard before Studio works
- Vercel env vars: May need manual configuration in Vercel dashboard (NEXT_PUBLIC_SANITY_PROJECT_ID=rzrgvvg3, NEXT_PUBLIC_SANITY_DATASET=production)
</blockers>

<context>
The project is building a website for KoorFameus, a children's and youth choir from Landen, Belgium.
Three choirs: Startkoor (youngest), Kinderkoor, Jeugdkoor (oldest).
The user wants all phases executed autonomously with minimal input.
GSD config: YOLO mode, comprehensive depth (10 phases), parallel execution, quality model profile.

The executor pattern that works: use `general-purpose` subagent type with inline instructions (the gsd-executor/gsd-planner/gsd-researcher agent definition files don't exist on disk, but gsd-executor/gsd-verifier/gsd-plan-checker DO exist as built-in subagent types).

Key URLs:
- Production: https://koorfameus.vercel.app
- GitHub: https://github.com/GolicoBV/KoorFameus
- Sanity Manage: https://www.sanity.io/manage/personal/project/rzrgvvg3
- Original site: https://sites.google.com/view/koorfameus/home
</context>

<next_action>
1. Ask user if they've configured CORS (or do it for them if possible)
2. Create the revalidation webhook route (/api/revalidate)
3. Write SUMMARY.md files for plans 02-01 through 02-05
4. Run phase verifier
5. Update STATE.md and ROADMAP.md for Phase 2 completion
6. Continue to Phase 3: Design System
</next_action>
