---
plan: 02-01
title: Create Sanity Project and Install Packages
phase: 2
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - .env.local
  - sanity.config.ts
autonomous: false
---

# Plan 02-01: Create Sanity Project and Install Packages

## Objective
Initialize a new Sanity project for KoorFameus and install all required npm packages for Sanity CMS integration with Next.js 16.

## must_haves
- Sanity project created at sanity.io with project ID
- `next-sanity`, `sanity`, and `@sanity/image-url` packages installed
- Environment variables configured in `.env.local`
- Basic `sanity.config.ts` file created in project root
- CORS configured at sanity.io/manage for localhost:3000

## Tasks

<task id="1">
**Install Sanity packages**

Run the following command to install all required Sanity packages:

```bash
npm install next-sanity sanity @sanity/image-url
```

This installs:
- `next-sanity` - Official Next.js toolkit for Sanity
- `sanity` - Sanity Studio core
- `@sanity/image-url` - Image URL builder for optimized images
</task>

<task id="2" depends_on="1">
**Initialize Sanity project**

Run the Sanity CLI to create a new project:

```bash
npx sanity@latest init --env
```

When prompted:
1. Select "Create new project"
2. Project name: `KoorFameus`
3. Dataset: `production`
4. Project output path: Use current directory (.)
5. Select "Clean project with no predefined schemas"
6. TypeScript: Yes

This will:
- Create a new project at sanity.io
- Generate `sanity.config.ts` in project root
- Create a basic `sanity/` folder structure
- Write environment variables to `.env.local`

**USER ACTION REQUIRED:** Follow the interactive prompts to complete project creation.
</task>

<task id="3" depends_on="2">
**Verify environment variables**

Ensure `.env.local` contains the required variables:

```env
NEXT_PUBLIC_SANITY_PROJECT_ID=your_project_id
NEXT_PUBLIC_SANITY_DATASET=production
```

If missing, copy from the Sanity project dashboard at sanity.io/manage.
</task>

<task id="4" depends_on="3">
**Update sanity.config.ts for embedded Studio**

Update `sanity.config.ts` to set the basePath for embedding:

```typescript
import { defineConfig } from 'sanity'
import { structureTool } from 'sanity/structure'

export default defineConfig({
  name: 'koorfameus-studio',
  title: 'KoorFameus',

  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID!,
  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET!,

  basePath: '/studio',

  plugins: [
    structureTool(),
  ],

  schema: {
    types: [],
  },
})
```

Note: Schema types will be added in Plan 02-02.
</task>

<task id="5" depends_on="4">
**Configure CORS at Sanity**

**USER ACTION REQUIRED:** Go to sanity.io/manage and configure CORS:

1. Navigate to your project > API > CORS origins
2. Add the following origins:
   - `http://localhost:3000` (Allow credentials: Yes)
   - `https://koorfameus.vercel.app` (Allow credentials: Yes)
3. Save changes

This allows the embedded Studio to communicate with Sanity APIs.
</task>

<task id="6" depends_on="5">
**Add Sanity CDN to Next.js config**

Update `next.config.ts` to allow images from Sanity CDN:

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'cdn.sanity.io',
      },
    ],
  },
};

export default nextConfig;
```
</task>

<task id="7" depends_on="6">
**Verify installation**

Run the development server to verify no errors:

```bash
npm run dev
```

Check that:
- No import errors related to Sanity packages
- Environment variables are loaded (check browser console for any warnings)
</task>

## Verification

1. **Package verification:**
   ```bash
   npm list next-sanity sanity @sanity/image-url
   ```
   All three packages should be listed.

2. **Environment variables:**
   - `.env.local` exists with `NEXT_PUBLIC_SANITY_PROJECT_ID` and `NEXT_PUBLIC_SANITY_DATASET`

3. **Sanity project:**
   - Visit sanity.io/manage and confirm project "KoorFameus" exists

4. **CORS check:**
   - In sanity.io/manage > API > CORS origins, verify localhost:3000 is listed

5. **Dev server:**
   - `npm run dev` starts without Sanity-related errors
