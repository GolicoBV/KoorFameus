---
plan: 02-03
title: Set Up Embedded Sanity Studio at /studio Route
phase: 2
wave: 2
depends_on:
  - 02-01
  - 02-02
files_modified:
  - app/studio/[[...tool]]/page.tsx
  - app/studio/[[...tool]]/layout.tsx
autonomous: true
---

# Plan 02-03: Set Up Embedded Sanity Studio at /studio Route

## Objective
Embed Sanity Studio within the Next.js application at the `/studio` route using a catch-all route segment, enabling administrators to access the CMS directly from the website.

## must_haves
- Studio accessible at `/studio` URL path
- Catch-all route handles all Studio sub-routes (`/studio/desk`, `/studio/vision`, etc.)
- Separate layout for Studio that doesn't inherit app styling
- Studio loads without conflicts with main site styling
- 'use client' directive on page component (Studio requires client-side rendering)

## Tasks

<task id="1">
**Create Studio route directory**

Create the catch-all route directory for Studio:

```bash
mkdir -p "app/studio/[[...tool]]"
```

The `[[...tool]]` segment is an optional catch-all that handles:
- `/studio` (main dashboard)
- `/studio/desk` (content management)
- `/studio/desk/page/abc123` (specific document)
- `/studio/vision` (GROQ playground)
- etc.
</task>

<task id="2" depends_on="1">
**Create Studio page component**

Create `app/studio/[[...tool]]/page.tsx`:

```tsx
'use client'

import { NextStudio } from 'next-sanity/studio'
import config from '../../../sanity.config'

export default function StudioPage() {
  return <NextStudio config={config} />
}
```

Key points:
- `'use client'` is required - Sanity Studio is a client-side React application
- `NextStudio` handles all the routing and rendering
- Config is imported from the root `sanity.config.ts`
</task>

<task id="3" depends_on="1">
**Create Studio layout**

Create `app/studio/[[...tool]]/layout.tsx`:

```tsx
export const metadata = {
  title: 'KoorFameus Studio',
  description: 'Content beheer voor KoorFameus website',
}

export default function StudioLayout({
  children,
}: {
  children: React.ReactNode
}) {
  // Studio needs its own html/body to avoid style conflicts
  // This layout replaces the root layout for /studio routes
  return (
    <html lang="nl">
      <body style={{ margin: 0 }}>{children}</body>
    </html>
  )
}
```

Important: This layout intentionally does NOT include the app's global styles, fonts, or layout components. Sanity Studio has its own complete UI.
</task>

<task id="4" depends_on="2,3">
**Verify Studio loads**

Start the development server and test the Studio:

```bash
npm run dev
```

Navigate to `http://localhost:3000/studio`

Expected behavior:
1. Sanity login screen appears (or Studio dashboard if already logged in)
2. No styling conflicts with main site
3. Left sidebar shows "Site Instellingen", "Pagina's", "Team"
4. Can navigate to sub-routes like `/studio/desk`
</task>

<task id="5" depends_on="4">
**Test content type navigation**

In the Studio, verify each content type is accessible:

1. **Site Instellingen:**
   - Click "Site Instellingen" in sidebar
   - Should open a single document editor (singleton)
   - All fields should be visible: siteName, siteDescription, contactEmail, etc.

2. **Pagina's:**
   - Click "Pagina's" in sidebar
   - Should show document list (empty initially)
   - Click "+" to create new page
   - All fields should be present: title, slug, heroImage, heroText, content, seo

3. **Team:**
   - Click "Team" in sidebar
   - Should show document list
   - Create new teamMember
   - Verify conditional field behavior:
     - Select "Dirigent" role: "Koor" field should appear
     - Select "Bestuurslid" role: "Bestuursfunctie" field should appear, "Koor" should hide
</task>

<task id="6" depends_on="5">
**Test authentication flow**

If not logged in:

1. Studio should show Sanity login page
2. Click "Continue with Google" or enter email
3. After login, Studio dashboard should appear
4. Refresh page - should remain logged in (session persisted)
5. Open incognito window, navigate to /studio - should show login again
</task>

## Verification

1. **Route accessibility:**
   - `http://localhost:3000/studio` loads Studio
   - `http://localhost:3000/studio/desk` loads desk view
   - `http://localhost:3000/studio/vision` loads GROQ playground

2. **No style conflicts:**
   - Studio has its default Sanity styling
   - Main site styles don't leak into Studio
   - Studio fonts are Sanity defaults (not Geist)

3. **Authentication:**
   - Login flow works with Google/email
   - Session persists across page refreshes
   - Unauthorized users see login screen

4. **Content types:**
   - All three content types visible in sidebar
   - siteSettings opens as singleton (no document list)
   - page and teamMember show document lists
   - Creating documents works, fields render correctly

5. **Responsive:**
   - Studio works on mobile viewport (responsive sidebar)
